<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#27ae60"><meta name="twitter:card" content="summary"><meta property="og:title" content="Minecraft Legacy Docs"><meta property="og:description" content="Just playing around"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><title>Chunk Data | Minecraft Legacy Docs</title><meta name="description" content="Just playing around">
    <link rel="preload" href="/Legacy-Docs/assets/style-91ef8704.css" as="style"><link rel="stylesheet" href="/Legacy-Docs/assets/style-91ef8704.css">
    <link rel="modulepreload" href="/Legacy-Docs/assets/app-e0890417.js"><link rel="modulepreload" href="/Legacy-Docs/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/Legacy-Docs/assets/index.html-b63c2917.js"><link rel="modulepreload" href="/Legacy-Docs/assets/index.html-abe5fb8b.js"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-7d1352f1.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-3437c37e.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-12a510cc.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-5fed622a.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-e4edfe9d.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-9f61983f.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-9f1f8398.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-704cdd2c.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-003731d0.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-45b0e192.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-ea2e9e63.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-7fff35d2.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-8fa643bb.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-b69c1892.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-ff702c2f.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-396c1e92.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-5688077e.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-017938cc.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-f4200627.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/index.html-b03e4dbc.js" as="script"><link rel="prefetch" href="/Legacy-Docs/assets/404.html-87d54bd8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/Legacy-Docs/" class=""><!----><span class="site-name">Minecraft Legacy Docs</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/ModifiedCommand/Legacy-Docs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/ModifiedCommand/Legacy-Docs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Home <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/Legacy-Docs/" class="sidebar-item" aria-label="Legacy-Docs"><!--[--><!--]--> Legacy-Docs <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Legacy Save Files <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/Legacy-Docs/Saves/" class="router-link-active sidebar-item" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Saves/MCR/" class="sidebar-item" aria-label="MCR Structure"><!--[--><!--]--> MCR Structure <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Chunk Data"><!--[--><!--]--> Chunk Data <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/#_1-header-0x19" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. Header [..0x19]"><!--[--><!--]--> 1. Header [..0x19] <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/#_2-section-header-0x1a-0x4b" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Section Header [0x1A..0x4B]"><!--[--><!--]--> 2. Section Header [0x1A..0x4B] <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/#_3-section-data-0x4c-x-0x4c" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Section Data [0x4C..(*X+0x4C)]"><!--[--><!--]--> 3. Section Data [0x4C..(*X+0x4C)] <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/#_4-block-light-sky-light-x" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. Block Light &amp; Sky Light [X..??]"><!--[--><!--]--> 4. Block Light &amp; Sky Light [X..??] <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/#_5-height-map-terrainpopulatedflags-biomes-0x-0x-0x202" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. Height Map, TerrainPopulatedFlags, &amp; Biomes [0x??..(0x??+0x202)]"><!--[--><!--]--> 5. Height Map, TerrainPopulatedFlags, &amp; Biomes [0x??..(0x??+0x202)] <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Legacy-Docs/Saves/ChunkData/#_6-raw-nbt-data-0x" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. Raw NBT Data [0x??..]"><!--[--><!--]--> 6. Raw NBT Data [0x??..] <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Legacy Filetypes <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/Legacy-Docs/Formats/" class="sidebar-item" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Formats/ARC/" class="sidebar-item" aria-label="ARC"><!--[--><!--]--> ARC <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Formats/COL/" class="sidebar-item" aria-label="COL"><!--[--><!--]--> COL <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Formats/LOC/" class="sidebar-item" aria-label="LOC"><!--[--><!--]--> LOC <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Formats/Material/" class="sidebar-item" aria-label="Material"><!--[--><!--]--> Material <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Formats/Models/" class="sidebar-item" aria-label="Models"><!--[--><!--]--> Models <!--[--><!--]--></a><!----></li><li><a href="/Legacy-Docs/Formats/PCK/" class="sidebar-item" aria-label="PCK"><!--[--><!--]--> PCK <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="chunk-data" tabindex="-1"><a class="header-anchor" href="#chunk-data" aria-hidden="true">#</a> Chunk Data</h1><h2 id="_1-header-0x19" tabindex="-1"><a class="header-anchor" href="#_1-header-0x19" aria-hidden="true">#</a> 1. Header <code>[..0x19]</code></h2><ul><li>The first two bytes represent a short containing the chunk&#39;s version in hex. So far only <code>12 = Aquatic</code> is known.</li><li>The next 8 bytes represent two integers with the chunk&#39;s X and Z position respectively.</li><li>The last 16 bytes are two longs containing the <code>LastUpdate</code> and <code>InhabitedTime</code> tags.</li></ul><div class="language-diff line-numbers-mode" data-ext="diff"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  |00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
</span><span class="token prefix unchanged"> </span><span class="token line">  |-----------------------------------------------
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">00|00 0C 00 00 00 01 00 00 00 05 00 00 00 00 00 00
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  |^^^^^ ^^^^^^^^^^^ ^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^
</span><span class="token prefix unchanged"> </span><span class="token line">  |Ver.  Chunk X-Pos Chunk Z-Pos LastUpdate...
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">10|00 00 00 00 00 00 00 00 00 00 ?? ?? ?? ?? ?? ??
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  |^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^
</span><span class="token prefix unchanged"> </span><span class="token line">  |...   InhabitedTime
</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-section-header-0x1a-0x4b" tabindex="-1"><a class="header-anchor" href="#_2-section-header-0x1a-0x4b" aria-hidden="true">#</a> 2. Section Header <code>[0x1A..0x4B]</code></h2><blockquote><p><strong>*</strong> &quot;Sections&quot; are vertically-aligned cubes of 16×16×16 blocks (4096), and there are 16 of them in each chunk. Starting from 0 (y0) up to 15 (y255)</p></blockquote><ul><li>The first 0x2 <code>[0x1A..0x1B]</code> bytes define how large the block data is (multiply by <code>0x100</code> to get the actual size)</li><li>The next 0x20 bytes <code>[0x1C..0x3B]</code> contain 16 shorts defining offsets of where sections start called the <code>jump table</code>. If an offset matches the block data length (shown above), then there should be no more sections to parse.</li><li>The next 0x10 bytes <code>[0x3C..0x4B]</code> are the sizes of sections. Multiply by <code>0x100</code> to get the actual size. If a size is <code>0</code>, then there&#39;s probably no more sections to parse. (It is recommended to use the <code>jump table</code> if the whole chunk is loaded into memory for each section and not bother with sections sizes and reading into smaller chunks)</li></ul><h2 id="_3-section-data-0x4c-x-0x4c" tabindex="-1"><a class="header-anchor" href="#_3-section-data-0x4c-x-0x4c" aria-hidden="true">#</a> 3. Section Data <code>[0x4C..(*X+0x4C)]</code></h2><blockquote><p><strong>*</strong> X is defined in the Section Header as the &quot;block data size&quot; (The total length of the all the block data sections) <code>[0x1A..0x1B]</code><strong>†</strong> Y is defined in the Section Header as the &quot;section offset&quot;. Add <code>0x4C</code> to get the actual address in the chunk data. <code>[0x1C..0x3B</code><br><strong>‡</strong> Z is defined in the Section Header as the &quot;section size&quot;. <code>[0x3C..0x4B]</code><br><strong>⁂</strong> Grids are cubes of 4×4×4 blocks (64 blocks), and there are 64 of them per section (64x64 = 4096 blocks per section). They are stored in a 4x4x4 grid of the section. <strong>⸸</strong> The Block ID is the first 12 bits and the Block Data is the last 4 bits.<br><strong>Code:</strong> <code>Byte1 Byte2</code> - <code>Block ID = ((byte2 &lt;&lt; 4) + ((byte1 &amp; 0xF0) &gt;&gt; 4)) &amp; 0x1FF;</code> + <code>Data Value: byte1 &amp; 0xf;</code><br><strong>Example:</strong> <code>0x70 0x05</code> - <code>Block ID: 0x57 (87)</code> + <code>Data Value: 0x0 (0)</code></p></blockquote><p>For each section:</p><ul><li><p>The first 0x80 bytes <code>[†Y..Y+0x7F]</code> is the grid<code>⁂</code> index table. Grid indicies are stored in YZX format. <code>gridIndex = Y† + ((gx * 16) + (gz * 4) + gy)</code></p></li><li><p>The remaining bytes <code>[Y+0x80..(Y+(Z-0x80))]</code> define the &#39;palette&#39; data, storing what blocks are used in the section.</p></li><li><p>Each &quot;grid index&quot; consist of 2 bytes. The first nybble of the second byte defines the grid&#39;s format, which defines how the blocks are stored and how many bits are stored. Nybbles <code>3</code>, <code>0</code>, and <code>1</code> build the offset of where the grid&#39;s palette is stored in that section data. <code>offset = (nybble3 &lt;&lt; 8 | nybble0 &lt;&lt; 4 | nybble1) * 4</code> / <code>format = nybble2</code></p></li><li><p><strong>Example:</strong> <code>0x9C 0x40</code> - <code>Format = 0x4</code> + <code>Offset = 0x270</code></p></li><li><p>How to parse blocks from the format:</p></li></ul><table><thead><tr><th>Format</th><th>Palette Size</th><th>Description</th></tr></thead><tbody><tr><td>0</td><td>1 (0x01)</td><td>The entire grid is filled with just one type of block. Block is stored in the grid index itself (<code>byte 0</code> and <code>byte 1</code> make up the block data⸸). Copy <code>byte 0</code> and <code>byte 1</code> into the block data array 128 times (64 times each and alternating)</td></tr><tr><td>E</td><td>128 (0x80)</td><td>The palette for this grid is is 0x80 bytes long and are read straight into the block data array without parsing.</td></tr><tr><td>F</td><td>256 (0x100)</td><td>The format is the same as above and there is an extra 0x80 bytes at the end that are read straight into &quot;Liquid&quot; data without parsing.</td></tr><tr><td>2</td><td>12 (0x0C)</td><td>The grid contains only 2 block types. The first 2 shorts of the palette are the blocks. The last 8 bytes define bits that store the block&#39;s positions. (1 bit per block)</td></tr><tr><td>3</td><td>20 (0x14)</td><td>The format is the same as above and there is an extra 8 bytes at the end that point to the grid and are read into &quot;Liquid&quot; data. (1 bit per block)</td></tr><tr><td>4</td><td>24 (0x18)</td><td>The grid contains up to 4 block types. The first 4 shorts of the palette are the blocks. The last 16 bytes define bits that store the block&#39;s positions. (2 bits per block)</td></tr><tr><td>5</td><td>40 (0x28)</td><td>The format is the same as above and there is an extra 16 bytes at the end that point to the grid and are read into &quot;Liquid&quot; data. (2 bits per block)</td></tr><tr><td>6</td><td>40 (0x28)</td><td>The grid contains up to 8 block types. The first 8 shorts of the palette are the blocks. The last 28 bytes define bits that store the block&#39;s positions. (3 bits per block)</td></tr><tr><td>7</td><td>64 (0x40)</td><td>The format is the same as above and there is an extra 28 bytes at the end that point to the grid and are read into &quot;Liquid&quot; data. (3 bits per block)</td></tr><tr><td>8</td><td>64 (0x40)</td><td>The grid contains up to 16 block types. The first 16 shorts of the palette are the blocks. The last 32 bytes define bits that store the block&#39;s positions. (4 bits per block)</td></tr><tr><td>9</td><td>96 (0x60)</td><td>The format is the same as above and there is an extra 32 bytes at the end that point to the grid and are read into &quot;Liquid&quot; data. (4 bits per block)</td></tr></tbody></table><ul><li><p>If there are less blocks in the grid than the limit then it the rest will be filled with <code>0xFF</code>.</p></li><li><p>The extra pointers that gets parsed into &quot;Liquid&quot; data work the same way as the pointers to the blocks.</p></li><li><p>The code below shows how to get the block positions from the data (the previous explanation was incorrect):</p></li></ul><p>Here is working code for parsing these sub chunks (without extra &quot;Liquid&quot; data):</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span>size_t BitsPerBlock<span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> <span class="token keyword">const</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span><span class="token operator">*</span> grid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> BitsPerBlock<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint16_t</span><span class="token operator">&gt;</span> <span class="token function">palette</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">copy_n</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> size<span class="token punctuation">,</span> palette<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">uint8_t</span> v<span class="token punctuation">[</span>BitsPerBlock<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> BitsPerBlock<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                v<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buffer<span class="token punctuation">[</span>size <span class="token operator">+</span> i <span class="token operator">+</span> j <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">uint8_t</span> mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span><span class="token number">0x80</span> <span class="token operator">&gt;&gt;</span> j<span class="token punctuation">;</span>
                <span class="token keyword">uint16_t</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> BitsPerBlock<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    idx <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> k<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> size<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>unlikely<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">int</span> gridIndex <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> paletteIndex <span class="token operator">=</span> idx <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
                grid<span class="token punctuation">[</span>gridIndex<span class="token punctuation">]</span> <span class="token operator">=</span> palette<span class="token punctuation">[</span>paletteIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
                grid<span class="token punctuation">[</span>gridIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> palette<span class="token punctuation">[</span>paletteIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here is working code for parsing these sub chunks (with extra &quot;Liquid&quot; data):</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span>size_t BitsPerBlock<span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">ParseWithLayers</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> <span class="token keyword">const</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span><span class="token operator">*</span> grid<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span><span class="token operator">*</span> submergedGrid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> BitsPerBlock<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint16_t</span><span class="token operator">&gt;</span> <span class="token function">palette</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">copy_n</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> size<span class="token punctuation">,</span> palette<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">uint8_t</span> v<span class="token punctuation">[</span>BitsPerBlock<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">uint8_t</span> vSubmerged<span class="token punctuation">[</span>BitsPerBlock<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> BitsPerBlock<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> offset <span class="token operator">=</span> size <span class="token operator">+</span> i <span class="token operator">+</span> j <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>
                v<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
                vSubmerged<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset <span class="token operator">+</span> BitsPerBlock <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">uint8_t</span> mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span><span class="token number">0x80</span> <span class="token operator">&gt;&gt;</span> j<span class="token punctuation">;</span>
                <span class="token keyword">uint16_t</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">uint16_t</span> idxSubmerged <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> BitsPerBlock<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    idx <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> k<span class="token punctuation">;</span>
                    idxSubmerged <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>vSubmerged<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> k<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> size <span class="token operator">||</span> idxSubmerged <span class="token operator">&gt;=</span> size<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>unlikely<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">int</span> gridIndex <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> paletteIndex <span class="token operator">=</span> idx <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> paletteIndexSubmerged <span class="token operator">=</span> idxSubmerged <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
                grid<span class="token punctuation">[</span>gridIndex<span class="token punctuation">]</span> <span class="token operator">=</span> palette<span class="token punctuation">[</span>paletteIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
                grid<span class="token punctuation">[</span>gridIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> palette<span class="token punctuation">[</span>paletteIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                submergedGrid<span class="token punctuation">[</span>gridIndex<span class="token punctuation">]</span> <span class="token operator">=</span> palette<span class="token punctuation">[</span>paletteIndexSubmerged<span class="token punctuation">]</span><span class="token punctuation">;</span>
                submergedGrid<span class="token punctuation">[</span>gridIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> palette<span class="token punctuation">[</span>paletteIndexSubmerged <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-block-light-sky-light-x" tabindex="-1"><a class="header-anchor" href="#_4-block-light-sky-light-x" aria-hidden="true">#</a> 4. Block Light &amp; Sky Light <code>[X..??]</code></h2><blockquote><p><strong>*</strong> X is the total length of the all the block data sections, as shown in the <strong>Section Data</strong>. Add <code>0x4C</code> to get the starting offset. <code>[0x1A..0x1B]</code></p></blockquote><ul><li><p>Skylight and Blocklight are nybble arrays of 0x8000 bytes stored in XZY format</p></li><li><p>There are 4 different &quot;sections&quot; of light, the first 2 are the SkyLight, and the last 2 being the BlockLight.</p></li></ul><table><thead><tr><th>For each section</th></tr></thead><tbody><tr><td>The first 4 bytes (*int) times by 128 plus 128 defines the length of that section <code>(*int + 1) * 0x80</code> or <code>*int * 0x80 + 0x80</code></td></tr><tr><td>The first 0x80 bytes is the header for the data</td></tr></tbody></table><table><thead><tr><th>For each byte in the header</th></tr></thead><tbody><tr><td>If the byte is <code>0x80</code> then fill 128 bytes of Skylight/Blocklight with <code>0x00</code></td></tr><tr><td>If the byte is <code>0x81</code> then fill 128 bytes of Skylight/Blocklight with <code>0xFF</code></td></tr><tr><td>If the byte is not <code>0x80</code> or <code>0x81</code>, then read 128 bytes of data with offset of <code>byte value * 0x80 + 0x80</code> from the section into Skylight/Blocklight data. (Note that the <code>+0x80</code> is there because the header is 128 bytes long)</td></tr></tbody></table><h2 id="_5-height-map-terrainpopulatedflags-biomes-0x-0x-0x202" tabindex="-1"><a class="header-anchor" href="#_5-height-map-terrainpopulatedflags-biomes-0x-0x-0x202" aria-hidden="true">#</a> 5. Height Map, TerrainPopulatedFlags, &amp; Biomes <code>[0x??..(0x??+0x202)]</code></h2><ul><li>The first 0x100 bytes store the HeightMap byte array.</li><li>The next 0x2 bytes store the short <code>TerrainPopulatedFlags</code>.</li><li>The last 0x100 bytes store the Biomes byte array.</li></ul><h2 id="_6-raw-nbt-data-0x" tabindex="-1"><a class="header-anchor" href="#_6-raw-nbt-data-0x" aria-hidden="true">#</a> 6. Raw NBT Data <code>[0x??..]</code></h2><ul><li>The rest of the file contains raw NBT data after all the other data.</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ModifiedCommand/Legacy-Docs/edit/main/docs/Saves/ChunkData/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 33438654+PiSaucer@users.noreply.github.com">PiSaucer</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/Legacy-Docs/Saves/MCR/" class="" aria-label="MCR Structure"><!--[--><!--]--> MCR Structure <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/Legacy-Docs/assets/app-e0890417.js" defer></script>
  </body>
</html>
